initialValue[4,]<-QS
initialValue[5,]<-QI
initialValue[6,]<-QG
initialValue[7,]<-S0
initialValue[8,]<-Fr0
dayData<-list(dayStart,dayEnd,dayE,dayP,dayQ,initialValue)
names(dayData)<-c("dayStart","dayEnd","dayE","dayP","dayQ","initialValue")
dataE<-dcast(data = hourEv,YMDHM~STCD)
hourQ<-hourQ[,-4:-5]
dataQ<-dcast(data =hourQ,YMDHM~STCD)
dataP<-dcast(data = hourRain,YMDHM~STCD,mean,value.var = "P")
colnames(dataE)<-c("YMDHM","stationE")
dataQ<-data.frame(dataQ,dataQ$`41107100`)
colnames(dataQ)<-c("YMDHM","Qmea","Qcal")
colnames(dataP)<-c("YMDHM","stationP1","stationP2","stationP3","stationP4","stationP5","stationP6","stationP7","stationP8","stationP9")
timeStart<-ymd_hms("2003-8-26 22:00:00")
timeEnd<-ymd_hms("2003-9-3 19:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData1<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2003-9-3 19:00:00")
timeEnd<-ymd_hms("2003-9-9 12:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData2<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2003-9-17 11:00:00 ")
timeEnd<-ymd_hms("2003-9-24 8:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData3<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2004-9-2 14:00:00")
timeEnd<-ymd_hms("2004-9-11 2:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData4<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2005-7-1 6:00:00")
timeEnd<-ymd_hms("2005-7-8 1:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData5<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2005-9-25 20:00:00")
timeEnd<-ymd_hms("2005-10-5 18:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData6<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2006-9-3 8:00:00")
timeEnd<-ymd_hms("2006-9-7 9:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData7<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2006-9-25 7:00:00")
timeEnd<-ymd_hms("2006-10-2 4:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData8<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2007-7-4 4:00:00")
timeEnd<-ymd_hms("2007-7-10 21:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData9<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2008-7-19 9:00:00")
timeEnd<-ymd_hms("2008-7-25 3:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData10<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2009-8-18 14:00:00")
timeEnd<-ymd_hms("2009-8-25 1:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData11<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2010-7-15 8:00:00")
timeEnd<-ymd_hms("2010-7-21 1:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData12<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2010-7-21 1:00:00")
timeEnd<-ymd_hms("2010-7-27 8:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData13<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2010-8-18 20:00:00")
timeEnd<-ymd_hms("2010-8-22 18:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData14<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2010-8-22 18:00:00")
timeEnd<-ymd_hms("2010-8-27 15:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData15<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
names(floodData1)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData2)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData3)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData4)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData5)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData6)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData7)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData8)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData9)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData10)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData11)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData12)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData13)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData14)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData15)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
hhData<-list(modelPapameter,basinInfo,dayData,floodData1,floodData2,floodData3,floodData4,floodData5
,floodData6,floodData7,floodData8,floodData9,floodData10,floodData11,floodData12,floodData13,floodData14,floodData15)
hh.names<-strsplit("modelPapameter,basinInfo,dayData,floodData1,floodData2,floodData3,floodData4,floodData5,floodData6,floodData7,floodData8,floodData9,floodData10,floodData11,floodData12,floodData13,floodData14,floodData15",",")
names(hhData)<-hh.names[[1]]
hhData[[3]]$dayStart<-ymd(hhData[[3]]$dayStart)
hhData[[3]]$dayEnd<-ymd(hhData[[3]]$dayEnd)
hhData[[3]]$dayE$Date<-ymd(hhData[[3]]$dayE$Date)
hhData[[3]]$dayP$Date<-ymd(hhData[[3]]$dayP$Date)
hhData[[3]]$dayQ$Date<-ymd(hhData[[3]]$dayQ$Date)
for(i in 4:18){
hhData[[i]]$timeStart<-ymd_hms(hhData[[i]]$timeStart)
hhData[[i]]$timeEnd<-ymd_hms(hhData[[i]]$timeEnd)
hhData[[i]]$hourE$YMDHM<-ymd_hms(hhData[[i]]$hourE$YMDHM)
hhData[[i]]$hourP$YMDHM<-ymd_hms(hhData[[i]]$hourP$YMDHM)
hhData[[i]]$hourQ$YMDHM<-ymd_hms(hhData[[i]]$hourQ$YMDHM)
}
setwd("E:/RXAJ/RXAJ/src")
save(hhData,file = "hhData")
hourRain$YMDHM
##This script is used for data preparation
##The model parameter
parameterName<-c("KC","UM","LM","C","WM","B","IM","SM","EX","KG","KI","CI","CG","CS","L","KE","XE")
dayParameterValue<-c(0.6,20,90,0.08,180,0.3,0.03,10,1.2,0.4,0.3,0.7,0.995,0.35,0,24,0.35)
hourParameterValue<-c(0.6,20,90,0.08,180,0.3,0.03,10,1.2,0.35,0.35,0.65,0.998,0.085,0,1,0.35)
modelPapameter<-data.frame(dayParameterValue,hourParameterValue)
rownames(modelPapameter)<-parameterName
##The colname of basinInfo is the station code of each sub-basin
basinInfo<-matrix(nrow = 2,ncol = 9)
basinInfo<-as.data.frame(basinInfo)
basinInfo[1,]<-c(0.082,0.158,0.150,0.051,0.095,0.098,0.134,0.187,0.045)
basinInfo[2,]<-c(1,6,5,5,3,4,2,2,1)
rownames(basinInfo)<-c("sub-basin","sub-river")
colnames(basinInfo)<-c("stationP1","stationP2","stationP3","stationP4","stationP5","stationP6","stationP7","stationP8","stationP9")
basinArea<-1380
basinInfo<-list(basinInfo,basinArea)
##The model time-control
##The colname of floodInfo is the index number of each flood
library(reshape2)
library(lubridate)
library(RODBC)
#mycon<-odbcConnect("hehei")
mycon<-odbcConnectAccess("E:/Rlanguage/data.mdb")
dayEv<-sqlFetch(mycon,"ST_DAYEV")
dayQ<-sqlFetch(mycon,"ST_DAYRIVER")
dayRain<-sqlFetch(mycon,"ST_DAYRNFL")
hourEv<-sqlFetch(mycon,"ST_EV")
hourQ<-sqlFetch(mycon,"ST_RIVER")
odbcClose(mycon)
dayEv$YMDHM<-ymd(dayEv$YMDHM)
dayQ$YMDHM<-ymd(dayQ$YMDHM)
dayRain$YMDHM<-ymd(dayRain$YMDHM)
hourRain<-read.csv("E:/Rlanguage/ST_RNFL.CSV",encoding = "UTF-8")
colnames(hourRain)[1]<-"STCD"
hourRain$YMDHM
ymd_hm(hourRain$YMDHM)
##This script is used for data preparation
##The model parameter
parameterName<-c("KC","UM","LM","C","WM","B","IM","SM","EX","KG","KI","CI","CG","CS","L","KE","XE")
dayParameterValue<-c(0.6,20,90,0.08,180,0.3,0.03,10,1.2,0.4,0.3,0.7,0.995,0.35,0,24,0.35)
hourParameterValue<-c(0.6,20,90,0.08,180,0.3,0.03,10,1.2,0.35,0.35,0.65,0.998,0.085,0,1,0.35)
modelPapameter<-data.frame(dayParameterValue,hourParameterValue)
rownames(modelPapameter)<-parameterName
##The colname of basinInfo is the station code of each sub-basin
basinInfo<-matrix(nrow = 2,ncol = 9)
basinInfo<-as.data.frame(basinInfo)
basinInfo[1,]<-c(0.082,0.158,0.150,0.051,0.095,0.098,0.134,0.187,0.045)
basinInfo[2,]<-c(1,6,5,5,3,4,2,2,1)
rownames(basinInfo)<-c("sub-basin","sub-river")
colnames(basinInfo)<-c("stationP1","stationP2","stationP3","stationP4","stationP5","stationP6","stationP7","stationP8","stationP9")
basinArea<-1380
basinInfo<-list(basinInfo,basinArea)
##The model time-control
##The colname of floodInfo is the index number of each flood
library(reshape2)
library(lubridate)
library(RODBC)
#mycon<-odbcConnect("hehei")
mycon<-odbcConnectAccess("E:/Rlanguage/data.mdb")
dayEv<-sqlFetch(mycon,"ST_DAYEV")
dayQ<-sqlFetch(mycon,"ST_DAYRIVER")
dayRain<-sqlFetch(mycon,"ST_DAYRNFL")
hourEv<-sqlFetch(mycon,"ST_EV")
hourQ<-sqlFetch(mycon,"ST_RIVER")
odbcClose(mycon)
dayEv$YMDHM<-ymd(dayEv$YMDHM)
dayQ$YMDHM<-ymd(dayQ$YMDHM)
dayRain$YMDHM<-ymd(dayRain$YMDHM)
hourRain<-read.csv("E:/Rlanguage/ST_RNFL.CSV",encoding = "UTF-8")
colnames(hourRain)[1]<-"STCD"
hourRain$YMDHM<-ymd_hm(hourRain$YMDHM)
##hourRain$YMDHM<-as.POSIXct(hourRain$YMDHM,format="%Y-%m-%d %H:%M:%S")
dayStart<-ymd("2003-1-1")
dayEnd<-ymd("2012-12-31")
##dayEv$YMDHM<-strptime(dayEv$YMDHM,format = "%Y-%m-%d")
data1<-dcast(data = dayEv,YMDHM~STCD,value.var = "EA")
data1$YMDHM<-ymd(data1$YMDHM)
dayE<-data1[(difftime(dayEnd,data1$YMDHM,units = "days")>=0) & (difftime(dayStart,data1$YMDHM,units = "days")<=0),1:2]
colnames(dayE)<-c("Date","stationE")
data1<-dcast(data = dayRain,YMDHM~STCD,value.var = "PA")
dayP<-data1[(difftime(dayEnd,data1$YMDHM,units = "days")>=0) & (difftime(dayStart,data1$YMDHM,units = "days")<=0) ,1:ncol(data1)]
colnames(dayP)<-c("Date","stationP1","stationP2","stationP3","stationP4","stationP5","stationP6","stationP7","stationP8","stationP9")
dayQ<-dayQ[,-4:-5]
data1<-dcast(data = dayQ,YMDHM~STCD,value.var = "QA")
dayQ<-data1[(difftime(dayEnd,data1$YMDHM,units = "days")>=0) & (difftime(dayStart,data1$YMDHM,units = "days")<=0),1:ncol(data1)]
dayQ<-data.frame(dayQ,dayQ$`41107150`)
colnames(dayQ)<-c("Date","Qmea","Qcal")
initialValue<-as.data.frame(matrix(nrow = 8,ncol = 9))
colnames(initialValue)<-c("stationP1","stationP2","stationP3","stationP4","stationP5","stationP6","stationP7","stationP8","stationP9")
rownames(initialValue)<-c("WU","WL","WD","QS","QI","QG","SO","Fr0")
WU<-c(20,19.59,20,20,19.95,19.95,19.95,20,20)
WL<-rep(90,times=9)
WD<-rep(70,times=9)
QS<-rep(1.0,times=9)
QI<-rep(0.5,times=9)
QG<-rep(0.5,times=9)
S0<-rep(0.5,times=9)
Fr0<-rep(0.5,times=9)
initialValue[1,]<-WU
initialValue[2,]<-WL
initialValue[3,]<-WD
initialValue[4,]<-QS
initialValue[5,]<-QI
initialValue[6,]<-QG
initialValue[7,]<-S0
initialValue[8,]<-Fr0
dayData<-list(dayStart,dayEnd,dayE,dayP,dayQ,initialValue)
names(dayData)<-c("dayStart","dayEnd","dayE","dayP","dayQ","initialValue")
dataE<-dcast(data = hourEv,YMDHM~STCD)
hourQ<-hourQ[,-4:-5]
dataQ<-dcast(data =hourQ,YMDHM~STCD)
dataP<-dcast(data = hourRain,YMDHM~STCD,mean,value.var = "P")
colnames(dataE)<-c("YMDHM","stationE")
dataQ<-data.frame(dataQ,dataQ$`41107100`)
colnames(dataQ)<-c("YMDHM","Qmea","Qcal")
colnames(dataP)<-c("YMDHM","stationP1","stationP2","stationP3","stationP4","stationP5","stationP6","stationP7","stationP8","stationP9")
timeStart<-ymd_hms("2003-8-26 22:00:00")
timeEnd<-ymd_hms("2003-9-3 19:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData1<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2003-9-3 19:00:00")
timeEnd<-ymd_hms("2003-9-9 12:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData2<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2003-9-17 11:00:00 ")
timeEnd<-ymd_hms("2003-9-24 8:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData3<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2004-9-2 14:00:00")
timeEnd<-ymd_hms("2004-9-11 2:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData4<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2005-7-1 6:00:00")
timeEnd<-ymd_hms("2005-7-8 1:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData5<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2005-9-25 20:00:00")
timeEnd<-ymd_hms("2005-10-5 18:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData6<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2006-9-3 8:00:00")
timeEnd<-ymd_hms("2006-9-7 9:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData7<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2006-9-25 7:00:00")
timeEnd<-ymd_hms("2006-10-2 4:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData8<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2007-7-4 4:00:00")
timeEnd<-ymd_hms("2007-7-10 21:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData9<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2008-7-19 9:00:00")
timeEnd<-ymd_hms("2008-7-25 3:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData10<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2009-8-18 14:00:00")
timeEnd<-ymd_hms("2009-8-25 1:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData11<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2010-7-15 8:00:00")
timeEnd<-ymd_hms("2010-7-21 1:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData12<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2010-7-21 1:00:00")
timeEnd<-ymd_hms("2010-7-27 8:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData13<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2010-8-18 20:00:00")
timeEnd<-ymd_hms("2010-8-22 18:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0)& (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData14<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
timeStart<-ymd_hms("2010-8-22 18:00:00")
timeEnd<-ymd_hms("2010-8-27 15:00:00")
hourE<-dataE[((difftime(timeStart,dataE$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataE$YMDHM,units="hours")>=0) ),1:ncol(dataE)]
hourQ<-dataQ[(difftime(timeStart,dataQ$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataQ$YMDHM,units="hours")>=0),1:ncol(dataQ)]
hourP<-dataP[(difftime(timeStart,dataP$YMDHM,units = "hours")<=0) & (difftime(timeEnd,dataP$YMDHM,units="hours")>=0),1:ncol(dataP)]
floodData15<-list(timeStart,timeEnd,hourE,hourP,hourQ,initialValue)
names(floodData1)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData2)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData3)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData4)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData5)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData6)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData7)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData8)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData9)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData10)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData11)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData12)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData13)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData14)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
names(floodData15)<-c("timeStart","timeEnd","hourE","hourP","hourQ","initialValue")
hhData<-list(modelPapameter,basinInfo,dayData,floodData1,floodData2,floodData3,floodData4,floodData5
,floodData6,floodData7,floodData8,floodData9,floodData10,floodData11,floodData12,floodData13,floodData14,floodData15)
hh.names<-strsplit("modelPapameter,basinInfo,dayData,floodData1,floodData2,floodData3,floodData4,floodData5,floodData6,floodData7,floodData8,floodData9,floodData10,floodData11,floodData12,floodData13,floodData14,floodData15",",")
names(hhData)<-hh.names[[1]]
hhData[[3]]$dayStart<-ymd(hhData[[3]]$dayStart)
hhData[[3]]$dayEnd<-ymd(hhData[[3]]$dayEnd)
hhData[[3]]$dayE$Date<-ymd(hhData[[3]]$dayE$Date)
hhData[[3]]$dayP$Date<-ymd(hhData[[3]]$dayP$Date)
hhData[[3]]$dayQ$Date<-ymd(hhData[[3]]$dayQ$Date)
for(i in 4:18){
hhData[[i]]$timeStart<-ymd_hms(hhData[[i]]$timeStart)
hhData[[i]]$timeEnd<-ymd_hms(hhData[[i]]$timeEnd)
hhData[[i]]$hourE$YMDHM<-ymd_hms(hhData[[i]]$hourE$YMDHM)
hhData[[i]]$hourP$YMDHM<-ymd_hms(hhData[[i]]$hourP$YMDHM)
hhData[[i]]$hourQ$YMDHM<-ymd_hms(hhData[[i]]$hourQ$YMDHM)
}
setwd("E:/RXAJ/RXAJ/src")
save(hhData,file = "hhData")
View(dataQ)
class(hhData)
hhData
str(hhData)
# library(recharts)
showResult<-function(Date,P,Qcal,Qmea){
ext<-list(
xAxis=list(
type="category",
data=Date
),
yAxis=list(
list(
type ="value",
name="娴侀噺(m3路s-1)",
splitNumber="5",
min = "0",
max ="1000"
),
list(
type = "value",
name = "闄嶉洦閲?(mm)",
inverse="true",
splitNumber ="5",
min ="0",
max = "250"
)
)
)
series<-list(
list(
name= "Qmea",
type ="line",
data = Qmea,
yAxisIndex = "0"
),
list(
name= "Qcal",
type ="line",
data = Qcal,
yAxisIndex = "0"
),
list(
name = "precipitation",
type="bar",
data =P,
yAxisIndex = "1"
)
)
ePlot(series,ext)
}
NSE<-function(Qcal,Qmea){
return(1-sum((Qmea-Qcal)^2)/sum((Qmea-mean(Qmea))^2))
}
changeModelParameter<-function(parameterValue,paraIndex,value){
parameterName<-c("KC","UM","LM","C","WM","B","IM","SM","EX","KG","KI","CI","CG","CS","L","KE","XE")
funFlag = FALSE
if (length(parameterValue)!= 17){
stop("The parameterValue is not correct!!")
}
if (!is.numeric(value)){
stop("The value should be numeric!")
}
for(i in 1:length(parameterValue)){
if(parameterName[i]==paraIndex){
funFlag = TRUE
parameterValue[i]<-value
}
}
if(funFlag ==FALSE){
stop("The paraIndex is incorrect,please check the uppercase!")
}
return(parameterValue)
}
load("dayResult")
floodData3<-initHourData("2003-1-1",floodData3)
resultData<-hXAJ(modelParameter = hhData[[1]]$hourParameterValue,basinInfo = hhData[[2]],basinData = floodData3)
showResult(hhData$floodData3$hourQ$YMDHM,resultData$outP,resultData$stationQcal,floodData3$hourQ$Qmea)
load("hhData")
resultData<-dXAJ(modelParameter =hhData[[1]]$dayParameterValue,basinInfo = hhData[[2]],basinData = hhData[[3]])
NSE(dayResult$stationQcal,basinData[[5]]$Qmea)
showResult(resultData$Date,resultData$P,resultData$Qcal,resultData$Qmea)
library(recharts)
setwd("E:/RXAJ/RXAJ/R")
source("showResult.R",encoding = "utf-8")
setwd("E:/RXAJ/RXAJ/src")
library(Rcpp)
library(reshape2)
library(lubridate)
sourceCpp("dXAJ.cpp")
dXAJ<-function(modelParameter,basinInfo,basinData){
# browser()
cat("The simulation started from ",as.character(basinData[[1]])," and ended at ",as.character(basinData[[2]]),"\n")
dayResult<-.Call("dXAJ",modelParameter,basinInfo,basinData)
totalR<-dayResult[[12]]
totalR<-totalR*24*3.6/basinInfo[[2]]
sumResult<-data.frame(basinData[[4]]$Date,dayResult[[11]],dayResult[[10]],totalR,dayResult[[4]])
colnames(sumResult)<-c("Date","P","E","R","W")
sumResultBalance<-sumResult
sumResultBalance$Date<-year(sumResultBalance$Date)
sumResultBalance<-melt(sumResultBalance,id=c("Date"))
sumResultBalance<-dcast(sumResultBalance,Date~variable,sum)
sumResultBalance[,6]<-sumResultBalance[,2]-sumResultBalance[,3]-sumResultBalance[,4]-sumResultBalance[,5]
colnames(sumResultBalance)[6]<-"sum"
View(sumResultBalance)
save(sumResultBalance,file = "sumResultBalance")
save(dayResult,file = "dayResult")
resultData<-data.frame(basinData[[4]]$Date,dayResult[[11]],dayResult[[12]],basinData[[5]]$Qmea)
colnames(resultData)<-c("Date","P","Qcal","Qmea")
return(resultData)
}
initHourData<-function(dayStart,floodData){
try(load("dayResult"),stop("Error in read the Day Model Result ,please run the follow check list:\n 1.set the workstation \n 2.run the dayModel"))
numDiff<-floor(difftime(floodData$timeStart,dayStart,units = "days"))
cat(numDiff)
floodData$initialValue[1,]<-dayResult$outWu[numDiff,]
floodData$initialValue[2,]<-dayResult$outWl[numDiff,]
floodData$initialValue[3,]<-dayResult$outWd[numDiff,]
floodData$initialValue[4,]<-dayResult$outQs0[numDiff,]
floodData$initialValue[5,]<-dayResult$outQi0[numDiff,]
floodData$initialValue[6,]<-dayResult$outQg0[numDiff,]
floodData$initialValue[7,]<-dayResult$outS0[numDiff,]
floodData$initialValue[8,]<-dayResult$outFr0[numDiff,]
return(floodData)
}
sourceCpp("hXAJ.cpp")
hXAJ<-function(modelParameter,basinInfo,basinData){
res<-.Call("hXAJ",modelParameter,basinInfo,basinData)
}
load("hhData")
resultData<-dXAJ(modelParameter =hhData[[1]]$dayParameterValue,basinInfo = hhData[[2]],basinData = hhData[[3]])
NSE(dayResult$stationQcal,basinData[[5]]$Qmea)
showResult(resultData$Date,resultData$P,resultData$Qcal,resultData$Qmea)
View(hhData)
